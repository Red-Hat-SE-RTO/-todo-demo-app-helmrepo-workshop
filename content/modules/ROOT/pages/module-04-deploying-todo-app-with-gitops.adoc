= Module 4: Deploying the Todo App with GitOps

[%hardbreaks]
== Module Overview

This module focuses on deploying a Todo application using GitOps principles. Participants will learn how to set up a GitOps repository, define the desired state of the application, and use Argo CD for deployment. Additionally, they will explore Gitea as an alternative Git service and perform hands-on tasks to deploy the Todo app using GitOps.

== Key Learning Objectives

* Understand the GitOps workflow for application deployment.
* Learn how to set up and manage a GitOps repository.
* Use Argo CD for real-time synchronization and health monitoring.
* Explore Gitea as a self-hosted Git service and its integration with Argo CD.
* Deploy a Todo app using GitOps principles and observe automated deployment processes.

== Setting up the GitOps Repository

=== Initializing the Git Repository

To begin, participants need to set up a Git repository with the necessary configuration files for the Todo application. Follow these steps:

1. Create a new repository on your preferred Git hosting service (e.g., GitHub, GitLab).
2. Clone the repository to your local machine:
   ```bash
   git clone <repository-url>
   cd <repository-name>
   ```
3. Initialize the GitOps structure by creating the following directories:
   ```bash
   mkdir -p manifests/base manifests/overlays/production
   ```
4. Add the necessary Kubernetes manifests (e.g., deployment.yaml, service.yaml) to the `manifests/base` directory.
5. Commit and push the changes to the repository:
   ```bash
   git add .
   git commit -m "Initialize GitOps repository"
   git push origin main
   ```

=== GitOps-Compatible Structure

Ensure your repository follows a GitOps-compatible structure. This typically includes:

* A `base` directory for common configurations.
* An `overlays` directory for environment-specific configurations (e.g., production, staging).
* Kubernetes manifests (YAML files) defining the desired state of the application.

== Defining the Desired State

=== Key Resources

Define the desired state of the Todo application in Git. Key resources include:

* **Deployment:** Specifies the desired state of the application pods.
* **Service:** Exposes the application to the network.
* **ConfigMap/Secret:** Stores configuration data and sensitive information.

=== Version Control and Traceability

Emphasize the importance of version control and traceability in GitOps:

* Use Git branches for different environments (e.g., main for production, develop for staging).
* Tag releases for traceability and rollback capabilities.
* Maintain detailed commit messages to track changes.

== Using Argo CD for Deployment

=== Synchronizing with Argo CD

Demonstrate how to use Argo CD to synchronize the application deployment on OpenShift with the Git repository:

1. Install Argo CD on your OpenShift cluster.
2. Create an Argo CD application pointing to your Git repository:
   ```bash
   argocd app create todo-app \
     --repo <repository-url> \
     --path manifests/overlays/production \
     --dest-server https://kubernetes.default.svc \
     --dest-namespace default
   ```
3. Sync the application to deploy it:
   ```bash
   argocd app sync todo-app
   ```

=== Real-Time Synchronization and Health Monitoring

Highlight Argo CD features such as:

* **Real-Time Synchronization:** Automatically updates the deployment when changes are pushed to the Git repository.
* **Health Monitoring:** Monitors the health of the application and reports any issues.

== Exploring the Gitea Repository

=== Setting Up Gitea

Introduce Gitea as an alternative self-hosted Git service:

1. Deploy Gitea on your OpenShift cluster.
2. Create a new repository in Gitea.
3. Push your GitOps repository to Gitea:
   ```bash
   git remote add gitea <gitea-repository-url>
   git push gitea main
   ```

=== Integration with Argo CD

Discuss integrating Gitea with Argo CD:

* **Repository Authentication:** Use Gitea tokens for authentication.
* **Webhooks:** Configure webhooks in Gitea to trigger Argo CD synchronization.

== Hands-On Task

=== Deploying the Todo App

Participants will deploy the Todo app using GitOps principles:

1. Clone the GitOps repository.
2. Define the desired state in the repository.
3. Use Argo CD to deploy the application.
4. Explore Gitea features such as repository creation, managing pull requests, and configuring webhook triggers.
5. Observe how Argo CD automates the deployment process, ensuring the application matches the defined desired state in Git.

== Module Summary

Key takeaways from this module include:

* Understanding the GitOps workflow for application deployment.
* Setting up and managing a GitOps repository.
* Using Argo CD for real-time synchronization and health monitoring.
* Exploring Gitea as a self-hosted Git service and its integration with Argo CD.
* Deploying a Todo app using GitOps principles and observing automated deployment processes.

== Next Steps

Prepare to apply GitOps principles in advanced scenarios in the next module.
